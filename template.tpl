___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Logger",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Custom Template",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeIAAAIACAMAAABpU5+FAAAAqFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAs30iGAAAAN3RSTlMAKUlcg6PTz0sa6bFTk1vnCPj0AvyBEAsWBO+pM8jjumyYj8CJYyQfdjnefFYttJ/ZZz1xQUWb/2qX+AAAEfRJREFUeNrs2+dSYkEQhuHPRcCA8SgZUcwRc9//nW3VWrvlqqeHgUG7h++9hHl+TOgafNH55nJvOKgvYLXuXvd4/wx51x9dyYK311tFthU3dWEi3UYHefZYE/ZWvY0Ma42FZW18ey/svXETmfXYFZa18cuusA8NsjLuUzhz4/aWsKyNi6Gwr41byKMHYSUd52Hc5mE6d+ORsLyN2zxNqw39G18I04234TzOHnI3XhIW6s638aGwsLHr+XFPWLh1z8bcinM3LnaETVLPrXFTWObG58IyN+adafKqBTxG4uyNSRzT2KMxiaN6dWhM4khjuIvEkR3BWySObQPOChNf1bLtQKZpBF+FiLsvyLeKLIJxiPgQGacQq53AUyHiX8i4iiyCMYmnahl+IvF07cNNJC5rmIsxictaOhK1aziJxKXExWsexiQuJUYxFrULuIjE5cQoqqL2BA+RuJw4E2MSa8Qoqv4f/0isEqPTc29MYpU4bPwA65E4QIzOuqidwngk1onDxnvWjUkcJMb2nWtjEgeJw8YVWI7EExBje6gbb8JwJC4njjC+gd1IPBExWse6cQNmI7FCHGG8Y9eYxOXEmRiTWCGOM16BzUg8MTGaA93Y6FqRuJw4E2MSK8TRxia/jpA4hhjNumjtWjQmsUYcb/wMc5FYJY43foS1SBxJjHbNmTGJA8TxxpewFYmjidG+F62uMWMSxxNj1ZUxicPE8cZ9GIrECrFifOXHmMRTEePcjzGJFeIZjNduYSUSK8S68YETYxJPS4wzJ8YkVohnM95agolIXE6ciTGJZyDG0pZoHZzBQCQuJ87EmMQzEeN2zbwxiRXiFMbniI/EpohDxlc/bkziWYnR79o2JrFCnMh4FZGR2BpxyPg+1pjE5ohxadmYxCmIcbmrG7cRE4kNEuNRN65FGZPYIrFhYxInIsazVWMSK8RJjetNTBqJjRLjZcekMYnLiTMxJnFCYvzSjQeTGZPYMDFWDBqTOCkxGvaMSawRpzc+biEciU0To7FnzJjEqYlxY8yYxMmJsWnLmMTpiVHRjYfbUCOxfWKcWjImcZg4vfGdbkxiB8Q4FTPGJJ4PMR5Ebb2D8kjsghiHVoxJrBDP1bhXbkxiJ8R4smFM4vkR48KEMYkV4nkbVwt8GYn9EOPagDGJFeL5G4+/NCaxJ2Ls/7gxiedMjGVRe8XnSOyLGCeidoRPkdgZcch4Ax8jsTdijERthA+R2B1xrDGJ/RFjQ9RO8F8kdkiMoxhjEn8P8SWS9ipqy3gXib+HuIKkFRHGJE7W5nfeV4uxqO3jXyROVkOUtjqpjauido2/kThZL6JVAbIwXmjivmgdtJC4Tk/ULvAWiZPVFrUq8M3GT/gTidPVFbVRAfg3XmzigejdrSJxnXVROwQAEv9mx9520waiMArLhaRxEwzGhBRIU4TjCsdVDKbtfv8362XucpBm7M2f9b3BaGkOe8L5Z29YN9/PvvHnTlzZm/Kft6ObkLKpvepI4rCrd6gicUhT82dRkTig1hxaZCQO58Y8ymsSBzNbm0eHGYm1T2qzPYmDqc2lhxWJg/lqLnUkDiYzlxoSB1MczKOWxOpz04bEAZXm0ITEASW5+XMkcUh78+eKxCEVz+YOicNaXpo3JA4sfTJnSBxa6m0fkzi45bW5QuIITq5mJxLHkHj6AyFxHNmDeUHiSGZbL5FJHM2s8vG2JnFMXTu3wZE4rrvfm7V9DInPzqpunqf2fiQ+T2lX7R93kxhaEqtLSayOxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPJILI/E8kgsj8TySCyPxPLUEqddtm1ux3ixs9dtxu/VnEZ/fxVDJk5O198Mkc3LcbcaJHHaHAw9mU7ue0+cXCwMfSq/9Jo4JfAAyvveEhenuWEAi8myn8RpaRjIU91H4j88ogeUb+MnHuWGIe2KyIm3hoFdFFETHw2Da2MmvmJW8uAxXuKEYcmHLFbiu0uDC/MkUuKJwYkfqyiJay7i/+zd6XqaUBCA4bFxw6UKEnBBMS4YFZcm6tz/nbV9uqVWnTkytJTM+7sNjV+BwzkI2fGcRuJOBVVmOFYKiT+iypAn+cQdXR3OFHshnriBKlMm4olDVJnSbwsnXuhwOms+Cid+RZUxdU5iPU7/z5y2aOK2rhJnz0E08QuqzFkzEuudAP+1gWjiJ1SZUxZNvEWVOY5oYl2CyCJPMvEKVfYsJBO3UGVPJJlYb4/PooImzjtNnHuaOPc0ce5p4tzTxLmniXNPE+eeJs49TZx7mjj3NHHuaeLce8eJ3VW4m73O4w+Hl+XL4diYvxaf6mUH01SrbE/F509x9fhlo1+3Wo3n4/VkF5bffHZ5Smy3bupjWvphMS704CLr+Frap7LJj4EH13nBx+K2hV/kKXH9X3yR1Z0+Bx0gdOPTSDBvfRwBTzQfOJo4CTf81AWmYCZS2SlVe2DCj0NXE9+pVlyAic6HetIPez/2wFx0sjXxHVaf2mAsaib5sMuNDtxnMdDEplrjHtzFarp4n9G8A/c77DWxCXvmwd020/s26UMi7aYm5qtsIJF533yTASTWcDQx06wHCVlTwU3yBS1NzNH/AMl1ikabrIKMaKSJafsIRMQOf5MFkBK1NDFl6IGQZZ+7yS7ICRxNfNvUBzGbmvwmaQ1N/Bc/7k0faUMfZE008Q0VD0QtHfFN0toVTXzVyAJhsfwmaYGria+wAxBXJDa5hG8ydKjOc+JPIK8T4i1jSIPX18QXDSANVp/8heQ9a+JLWl1IxQNeVetCOvyaJr4ghpSEeM0DpGWtif8UQloKNl42BZ7ey3hSD4fDcDB7iICla2vic+4GmPyg+nEef9h4wNVMskn/49bBN1azAjCUNPG5Em9/qp72vz7s3YMPHJZz9/DOX9fwnDtYAOmgic+4EdC8x/N/sHOK7r5OdQtA+jDCS5w5UDojTUzsUdxbOdyJf+f7EUp0phle0+wAYaKJf7cEirfFy1YBkAb4J/Kvtes3X6hEeNHEv6nQO2IZr3EaQDniH4ZA6NWTzItZVVcTG01dWnu8zm3ccWb8CIQdMbu9ubbzB/NJqFMfZ2wv2Qt47QMQZnjGabPfzM6/ql5U14O9q7cEXLAl96ikk5+B6WBr4SDlCL94y0/NaV/vo75qTl27JL+sPj9SV6kBGvc/ZidqPNZX+rU1gkWcSctIWpodB5we3LRhTcgdxqehg1/ol08TjqdjpIVmP6MuOP+oiWkTuG2IDMSEs2V0yePZyKeJaQ1ipQg5JkYn4wI5nObTxDRLYu11ZDJ+6mf5XZI5TNwSOE7TE5JrgzO3byOfJqbQn7eLLK9wUxXfmGX5XZI5TDyRWXkdGJzRY8m76zQxaSzzea+IdSOXf1AfoAlNTDoKXaL6/CE1MSdeRiOamFKgRltMG/bPqRGzaTYa0cQUj/hHCl1e19lrxQs0ookpDnEOlVp0PrFXtgK86NQ2U9TE342kdqk1e8l4d9fC1hOYedTE35WJXUrq4mvN/pMPmlg28VDksphO8Io/PcJNY00smzikZqW4duxwz8R/Bk38VxM3pL5Q8Yk917nWxLKJt9RavnziMdFGEwsnlvqhJ/aBeqx78f95oKaGW+wD9bMmlk08lRpuNYlwOtzK6EXTEbmK7MPvmjhra2LZxBW4aYkE7r45Yd8REGvivzqBGUndcL9jX0EfNLFsYhtu8pCrSqw0sQfxG00smZheyncQRe7Pm7JP/11NLJx4ATeVhdadV/x7PvuaWDbxgTrA8vSpWzn4B46KJhZMTC/lF2UuviyDe4BKmlg28UxmeqtpcPHVIOY+NDGRWPanWjLXTHODWZKlJpZNvILbViI3ck4Mlj7aNl5Q6l7Q1sQcXbipKfLNqNDsD3M1NDHHB4lvGJ2MfteImKXWxLKJH4nLnZXApVfBaBTftTWxaOKpwDPaVx1itGX2QMaBJhZNbBMzEV4NSWOzh3fUesSYWhOLJsYGUNeplFGbONjXzI7rsNXEoolLcFtviIQYDPfKJvkoek0smbjfhtuiPvF/xPgBia0eNQDQxJKJMQbCi0O8adF4UF6l/spWE0smDoFydJK8D/d4x3M3/SHSpgtNzP61KJsRXjHw73kZh7sgG4dI2Fff2xz1pmjIMZni9054Se0BSJZ98YuMlF4Tb1nNe+9uGcJYC3+wLaAFWzzXL3pAm+EFThdI1RFeU3novcOVpgSJsQkc0WPFfdO3znuLj+dcWaem+c8tvMAZHN7nYmKSxHYEPN7L/HHyNCm+NjYd4JnhRY4FDL247pydGgZz772uFydJjFtIS2QTX0gmKy/Hk/qwsi8Pw10xLnTe8S0BiRJjDLLoJQU3ACN610fCxC0PZNH3flV68IYmTjsxliAN3Rb/IT+aWD6x7OuEzVd+7QDe0sRpJ3YKIIteTdh78IYmlk+c+gd+cLm/krwnTfxnYgx7IGrTZ96oL687yOMzMJMnxl0HBC1GSBtDGuJaLh9zKpAYT5KFV8jgPoC4RT2nT7KVSIxPYvtxNEIW9xPI6oydvD6sWCQx1n0QsWwh1zNIWlby+zxqmcQ4tEDA3Ea+UhukWKU8P3JcKDHWjpCU/4RGhhGI8B+dXD9VXioxurOEe1WwR0OOxAm5/Zm9O0lOHAiiMJxAgLFxQ2swYhCYQYAwk5mc979Zd4QW3RsbkLMgnbzvAlr8IalUqogcNIwPDhBJnHk/UH7NUciXey3Q97S3ffOzIYQSZ2oFyicoNTgXL2lSftG+fwfjP0QTc/iRJ3Lw/MC5dRZ5I0+Tzl1MeBFMnFkXA7pItH3nb/F/FehiUf31Xob4iCbONEbzsyu3ixufv6+3n13U97ns38+cJunEmcZm2aKTWvVNh6U8vBwiOsPvw2Ls2RrF5VdkhXymt25anNEnot3go8LCvN5oEn/eOZgV95vswK+txLflV9bDl0GpuovjVWEVz3fVSZqUew12Juz3ukm6XR6zS67iXXE5SUfl8ZvH/0FiQGJA4vuCxOYhsXlIbB4Sm4fE5iGxeUhsHhKbh8TmIbF5oon7DPpMJRO/Megzk0zcY9AnkkxcY1CnQ5KJRwzqPIgmnjCoUxZNHDOosxdN3PYZtInPSYz11g/2FJyTGC/jH2xDsombHoMuReHE1GVQpR9IJ94xqLKgMxNjD/OH8pvyiY8MiryQfGJaM6jRiFwknmJRrUedXCSmlEGJNblJHIwZVGi0HCWmFs73qODtyFViWuFvhAYTcpeYDlhy3V5KLhPTEffxraXkNjHNcaT6psItuU5M0wrDzTwdyX1iioYMNzKekevEmSJOzt+EPwjoSonp96LDcGXhR4tILPFpzUWD4Yr84ZRINPFp7ecaPpKvJBxvm0TyiU+LqskYT2zHvIdhvUVEORNLaMXFZb0E/wz4a0npXMvqfNamTM7E4MIjf61KF0FifZDYPCQ2D4nNQ2LzkNg8JDYPic1DYvOQ2DwkNg+JzUNi85DYPCQ2D4nNQ2LzkNg8JDYPic1DYvOQ2DwkNg+JzUNi85DYPCQ2D4nNQ2LzkNg8JDYPic1DYvOQ2DwkNg+JzUNi85DYPCQ2D4nNQ2LzkNg8JDYPic1DYvMUJR4QuLDVk7j/SCCv5OlJzJ1uGaR1PVaUGJxA4ruHxOYhsXlIbB4Sm4fE5gkmnjFodCAxLQaNYhLTDhkUmpKcdwZ9vIDk1Bj0qZCglEGfIQmKGfRZkqCgz6CN1yRJCYM2XRI1xWeTOgeSVWbQpUfCCh6DKkf6C29jw7okLsIOlyZPjyRv5TNoER7JhSVW1Wqk5MaAQYeEXNn+2Wg+HhSAhYF2gGe0Ph54IEjbLWRq7OajYGCBliYDbYGkxmhGHkggqCLOQHPAqTQayQMFRPTVGOgCJBRkzUcB/YGBtjoD/YAEn5KeAdfouDV9gKCUljyvKi3jFwAXgeZlW4fQWQAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Log to a console JSON string with desired info. Useful for debugging, especially for POST requests.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "logType",
    "radioItems": [
      {
        "value": "debug",
        "displayValue": "Log during debug and preview"
      },
      {
        "value": "always",
        "displayValue": "Always log"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "debug",
    "displayName": "Logs Settings",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "eventName",
    "displayName": "Event Name",
    "simpleValueType": true,
    "help": "It helps to find your event in logs later."
  },
  {
    "type": "CHECKBOX",
    "name": "eventData",
    "checkboxText": "Log all Event Data",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "requestUrl",
    "checkboxText": "Log Request Url",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "requestBody",
    "checkboxText": "Log Request Body",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "requestBodyJson",
    "checkboxText": "Parse Request Body as JSON",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "requestBody",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "customGroup",
    "displayName": "Custom Data",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "custom",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const JSON = require('JSON');
const getAllEventData = require('getAllEventData');
const makeTableMap = require('makeTableMap');
const getRequestHeader = require('getRequestHeader');
const getRequestBody = require('getRequestBody');
const getRequestPath = require('getRequestPath');
const getRequestQueryString = require('getRequestQueryString');
const logToConsole = require('logToConsole');
const getContainerVersion = require('getContainerVersion');
const containerVersion = getContainerVersion();
const isDebug = containerVersion.debugMode;
const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = getRequestHeader('trace-id');

if (isLoggingEnabled) {
    let dataToLog = {
        'Name': 'Logger',
        'Type': 'Message',
        'TraceId': traceId,
        'EventName': data.eventName ? data.eventName : 'Logger',
    };

    if (data.custom && data.custom.length > 0) {
        dataToLog.CustomData = makeTableMap(data.custom, 'name', 'value');
    }

    if (data.eventData) {
        dataToLog.EventData = getAllEventData();
    }

    if (data.requestUrl) {
        dataToLog.RequestUrl = getRequestPath();

        const queryString = getRequestQueryString();
        if (queryString !== '') {
            dataToLog.RequestUrl += '?' + queryString;
        }
    }

    if (data.requestBody) {
        const body = getRequestBody();

        dataToLog.RequestBody = data.requestBodyJson && body ? JSON.parse(body) : body;
    }

    logToConsole(JSON.stringify(dataToLog));
}

data.gtmOnSuccess();

function determinateIsLoggingEnabled() {
    if (!data.logType) {
        return isDebug;
    }

    if (data.logType === 'debug') {
        return isDebug;
    }

    return data.logType === 'always';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 18/04/2022, 09:51:02


